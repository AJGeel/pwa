<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <title>Pomodoro App &mdash; Prototype</title>
    <link rel="stylesheet" type="text/css" href="css/reset.css" />
    <link rel="stylesheet" type="text/css" href="css/pomo.css" />
    <link rel="shortcut icon" href="https://arthurgeel.com/experiments/img/favicon.png" />
    <link rel="manifest" href="js/manifest.json">

  </head>
  <body>

    <div class="wrapper">

      <p class="timer">
        <span id="minutes">25</span>:<span id="seconds">00</span>
      </p>

      <div class="row first">
        <a href="#!" id="startStopBtn">Start</a>
        <a href="#!" id="resetBtn">Reset</a>
      </div>

      <div class="divider"></div>

      <div class="row last">
        <a href="#!" id="study20">05</a>
        <a href="#!" class="active" id="study25">25</a>
        <a href="#!" id="study30">üí£</a>
      </div>


      <div class="row stats hide-for-mobile">
        <h2 id="title">My stats</h2>
        <div>
          <p>Daily:</p>
          <p id="dailyCount">0</p>
        </div>
        <div>
          <p>Weekly:</p>
          <p id="totalCount">0</p>
        </div>
        <div>
          <p>Score:</p>
          <p id="prodScore">500</p>
        </div>
      </div>

    </div>

    <div class="footer hide-for-mobile">
      <p>December 2017 &mdash; Coded with <span id="footerEmoji"></span> by <a href="https://arthurgeel.com/">Arthur Geel</a>.</p>
    </div>

  </body>

  <script>
    var timeLeft = 1500;
    var timerId = setInterval(countdown, 1000);
    var countdownActive = false;
    var gongPlaying = false;
    var dailyCount = 0;
    var totalCount = 7;
    var prodScore = 500;


    document.getElementById("dailyCount").innerHTML = dailyCount;
    document.getElementById("totalCount").innerHTML = totalCount;
    document.getElementById("prodScore").innerHTML = prodScore;

    function countdown() {
      if (timeLeft == 0) {
        var gongPlaying = false;
        document.getElementById("startStopBtn").classList.remove("active");
        document.getElementById("startStopBtn").classList.innerHTML = "Start";
        document.getElementById("resetBtn").classList.toggle("active"); // flashes the reset button

      } else {
        if (timeLeft == 1){
          if (!gongPlaying){
            var gong = new Audio('gong.mp3'); // Play the gong sound effect
            gong.play();
            gongPlaying = true; // Reset the gongPlaying variable to prevent audio stacking

            dailyCount++;
            totalCount++;
            prodScore = prodScore + dailyCount + Math.sqrt(totalCount);
            document.getElementById("dailyCount").innerHTML = dailyCount;
            document.getElementById("totalCount").innerHTML = totalCount;
            document.getElementById("prodScore").innerHTML = Math.floor(prodScore);

          }
        }

        if (countdownActive){   // Remove one second, every second
          timeLeft--;
        };
      }

      formatSeconds(timeLeft);
    }

    document.getElementById("startStopBtn").addEventListener("click", startStopFunction);
    document.getElementById("resetBtn").addEventListener("click", resetFunction);
    document.getElementById("study20").addEventListener("click", changeTo20);
    document.getElementById("study25").addEventListener("click", changeTo25);
    document.getElementById("study30").addEventListener("click", changeTo30);

    function startStopFunction(){
      countdownActive = !countdownActive;
      if (countdownActive){
        document.getElementById("startStopBtn").innerHTML = "Pause";
        document.getElementById("startStopBtn").classList.toggle("active");
      } else {
        document.getElementById("startStopBtn").innerHTML = "Start";
        document.getElementById("startStopBtn").classList.toggle("active");
      }
    }

    function resetFunction(){
      timeLeft = 1500;

      if(countdownActive){
        countdownActive = !countdownActive;
        document.getElementById("startStopBtn").innerHTML = "Start";
        document.getElementById("startStopBtn").classList.remove("active");
      }

      if(document.getElementById("study25").classList.contains("active")){
        // do nothing
      } else {
        document.getElementById("study25").classList.toggle("active");
        document.getElementById("study20").classList.remove("active");
        document.getElementById("study30").classList.remove("active");
      }
    }

    function changeTo20(){
      timeLeft = 300;

      document.getElementById("resetBtn").classList.remove("active");

      if(document.getElementById("study20").classList.contains("active")){
        // do nothing
      } else {
        document.getElementById("study20").classList.toggle("active");
        document.getElementById("study25").classList.remove("active");
        document.getElementById("study30").classList.remove("active");

        if(!countdownActive){
          countdownActive = !countdownActive;
          document.getElementById("startStopBtn").innerHTML = "Pause";
          document.getElementById("startStopBtn").classList.toggle("active");
        }
      }
    }

    function changeTo25(){
      timeLeft = 1500;

      if(document.getElementById("study25").classList.contains("active")){
        // do nothing
      } else {
        document.getElementById("study25").classList.toggle("active");
        document.getElementById("study20").classList.remove("active");
        document.getElementById("study30").classList.remove("active");

        if(!countdownActive){
          countdownActive = !countdownActive;
          document.getElementById("startStopBtn").innerHTML = "Pause";
          document.getElementById("startStopBtn").classList.toggle("active");
        }
      }
    }

    function changeTo30(){
      timeLeft = 6;

      if(document.getElementById("study30").classList.contains("active")){
        // do nothing
      } else {
        document.getElementById("study30").classList.toggle("active");
        document.getElementById("study20").classList.remove("active");
        document.getElementById("study25").classList.remove("active");

        if(!countdownActive){
          countdownActive = !countdownActive;
          document.getElementById("startStopBtn").innerHTML = "Pause";
          document.getElementById("startStopBtn").classList.add("active");
          document.getElementById("resetBtn").classList.remove("active");
        }
      }
    }


    function formatSeconds(input) {
      input = Number(input);
      var m = Math.floor(input % 3600 / 60);   // changes seconds to minutes
      var s = Math.floor(input % 3600 % 60);   // shows the remainder seconds

      var formattedM = ("0" + m).slice(-2);    // upkeeps the "00" format
      var formattedS = ("0" + s).slice(-2);    // upkeeps the "00" format

      if (countdownActive){
        document.title = (formattedM + ":" + formattedS + " ‚Äî Time to study"); // changes the page title to the current time
      }

      // Todo: fix the annoying 1 second delay.

      document.getElementById('minutes').innerHTML = formattedM;
      document.getElementById('seconds').innerHTML = formattedS;

    }

  </script>

  <script>
  var emojiMatrix = ['ü•ë', '‚òïÔ∏è', 'üçª', 'ü•É', 'üçæ', 'ü•É', 'üç™', 'üéâ', 'üî≠', 'üñ•', 'üíª', 'üéß', '‚ù§Ô∏è', 'üíõ', 'üíö', 'üíô', 'üíú', 'üíñ', 'üíù', 'üé∂', 'ü§ò', 'üëê', 'ü§û', '‚òò', 'üëÄ', 'üëì', '‚è±', '‚è≥', 'üîã', 'üí°', 'üî®',];
  var emojiNumber = Math.floor(emojiMatrix.length*Math.random());
  document.getElementById('footerEmoji').innerHTML = emojiMatrix[emojiNumber];
  </script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-84000548-1', 'auto');
  ga('send', 'pageview');
  </script>

</html>
